---
layout: post
title: 支持向量机SMO序列最小最优化算法实现
category: blog
description: 《统计学习方法》书中SMO算法的实现
---

最近在看李航教授的《统计学习方法》的过程中，发现支持向量机部分的SMO算法的数理部分第一次看的时候有点吃力，反复看了两三遍才算勉强弄明白了证明和推导过程。作为一个所谓的工程师，遇到比较晦涩的理论脑袋里面浮现的第一个念头当然就是去实践它。上网查了一下，果然有[JustForCS](http://www.cnblogs.com/JustForCS/p/5283489.html)和[刘洪江](http://liuhongjiang.github.io/tech/blog/2012/12/28/svm-smo/)两位同道已经完成了SMO算法实现的代码。

但是仔细研究了一下代码，发现他们的代码中都对违反KKT原则条件做了更近一步的推导和对SMO选择变量部分做了一些简化。原书中对于选择变量的算法是以最违反KKT原则的alpha_i作为锚定的第一变量，下降最大的alpha_j作为选定的第二变量继而更新alpha值。而在这两位的代码中，他们都选择了随机选择变量然后计算优化步长来决定是否使用变量。

所以在这里也打算以《统计学习方法》一书中的算法作为标准，手动实现SMO算法。当然这样并不意味着就一定比上面两位的实现方式要好，只不过是更贴近书中算法的说明从而更容易理解。

对于支持向量机比较全面的描述可以参考[文章](http://blog.csdn.net/crazy_programmer_p/article/details/38512945)。

这里直接给出《统计学习方法》一书中关于SMO的算法说明。

## SMO算法

<p style="text-indent:0"><em style="color:blue"> 输入：</em></p>训练数据集 $ T= \\{ ({x\_1},{y\_1}),({x\_2},{y\_2}), \cdot \cdot \cdot ,({x\_N},{y\_N}) \\} $  

其中$ {x\_i} \in \chi  \in {\mathbb{R}^n}$，${y\_i} \in \\{-1,+1\\}$，$i=1,2,\cdot\cdot\cdot,N$，精度$\varepsilon$。

<p style="text-indent:0"><em style="color:blue">输出：</em>近似解$\hat a$</p>

<p style="text-indent:0"><em style="color:blue">算法描述：</em></p>

(1) 取初始值${a^{(0)}}=0$，令$K=0$

(2) 选取优化变量 ${a\_1^{(k)}}$ , ${a\_2^{(k)}}$ , 针对优化问题，求得最优解 ${a\_1^{(k+1)}}$ , ${a\_2^{(k+1)}}$ 并且更新 ${a^{(k)}}$ 为 ${a^{(k+1)}}$ 。

(3) 在精度条件范围内是否满足停机条件，即**是否有变量违反KKT条件**，如果违反了，则令$k=k+1$，跳转(2)，否则(4)。

(4) 求得近似解$\hat a = a^{(k+1)}$

下面就对(2)，(3)步分别解释。

### 违反KKT条件
SMO的核心解法是通过svm的原始问题，构造拉格朗日函数，并求解对偶换算得出的最优化问题。而通过定理，我们可以知道对偶问题等价的是对偶问题的KKT条件，换句话说，就是只要找到对应的${a^\*}$满足了下列KKT条件，那么原始问题和对偶问题就解决了。

SVM的对偶问题对应的KKT条件为：

$$
\begin{array}{l}
\quad {a_i} = 0 \quad \Leftrightarrow \quad {y_i}g({x_i}) \ge 1\\
0 < {a_i} < C \quad \Leftrightarrow \quad {y_i}g({x_i}) = 1\\
\quad {a_i} = C \quad \Leftrightarrow \quad {y_i}g({x_i}) \le 1
\end{array}
$$

其中:

$$
g(x) = \sum\limits_{i = 1}^N { {a_i}{y_i}K({x_i},{x_j}) + b} 
$$

因为计算机在计算的时候是有精度范围的，所以我们引入一个计算精度值$\varepsilon$，那么KKT条件就变成了：

$$
\begin{array}{l}
{a_i} = 0 \Leftrightarrow {y_i}g({x_i}) \ge 1 - \varepsilon \\
0 < {a_i} < C \Leftrightarrow 1 - \varepsilon  \le {y_i}g({x_i}) \le 1 + \varepsilon \\
{a_i} = C \Leftrightarrow {y_i}g({x_i}) \le 1 + \varepsilon 
\end{array}
$$
那么相应的违规KKT条件的分量应该满足下列不等式：
$$
{\rm{Against\ KKT:}}
$$
$$
\begin{array}{l}
{a_i} = 0 \Leftrightarrow {y_i}g({x_i}) > 1 - \varepsilon \\
0 < {a_i} < C \Leftrightarrow 1 - \varepsilon > {y_i}g({x_i}) or {y_i}g({x_i}) > 1 + \varepsilon \\
{a_i} = C \Leftrightarrow {y_i}g({x_i}) > 1 + \varepsilon 
\end{array} 
$$

其实，通过推导，我们可以得到一个更简单的形式：
$$
{\rm{Against\ KKT:}}
$$
$$
\begin{array}{l}
{a_i} < C \quad \Leftrightarrow \quad  - \varepsilon  > {y_i}{E_i}\\
0 < {a_i} \quad \Leftrightarrow \quad {y_i}{E_i} >  + \varepsilon 
\end{array}
$$
其中：
$$
{E_i} = g({x_i}) - {y_i}
$$

但是就像我之前说的，为了便于理解书中算法，这里我还是坚持使用的KKT条件的原始形式。

